<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriSense App Prototype</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS for Interactive Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .figma-container {
            width: 100%;
            max-width: 420px; /* Increased max-width for better display */
            height: 890px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15), 0 0 0 12px #1f2937;
            border-radius: 40px;
            overflow: hidden;
            position: relative;
        }
        .figma-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f8fafc;
            transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            transform: translateX(100%);
            overflow-y: auto;
            padding-bottom: 80px; /* Ensure space for bottom nav */
        }
        .figma-screen.active { transform: translateX(0); }
        .figma-screen.inactive-left { transform: translateX(-100%); }
        .status-bar { height: 44px; width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 0 24px; font-size: 15px; font-weight: 600; position: absolute; top: 0; left: 0; z-index: 1000; color: #1f2937; }
        .bottom-nav { position: absolute; bottom: 0; left: 0; width: 100%; height: 80px; background-color: rgba(255,255,255,0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-top: 1px solid #e5e7eb; display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .nav-btn.active svg, .nav-btn.active p { color: #2563eb; }
        #map, #locker_map { height: 100%; width: 100%; z-index: 5;}
        .dot { transition: transform 0.2s linear; }
        input:checked ~ .dot { transform: translateX(100%); }
        input:checked ~ .block { background-color: #2563eb; }
        .map-card { transition: transform 0.3s ease-in-out; transform: translateY(200%); }
        .map-card.active { transform: translateY(0); }
        .tab-btn.active { border-bottom-color: #2563eb; color: #2563eb; font-weight: 600; }
        .points-toast { transition: opacity 0.5s, transform 0.5s; }
        #fingerprint-canvas { cursor: pointer; border-radius: 12px; }
        .fingerprint-success { background-color: #4ade80 !important; }
        .scroll-hidden::-webkit-scrollbar { display: none; } /* Hide scrollbar */
        .scroll-hidden { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-800 flex items-center justify-center min-h-screen p-8">

    <div class="figma-container bg-f8fafc">
        
        <!-- All Screens Container. Holds both signup and main app screens -->
        <div id="appView" class="w-full h-full relative">
            <!-- Screens are injected here by JavaScript -->
        </div>
        
        <!-- This is a container for elements that should appear on top of all screens, like the nav bar -->
        <div id="chrome" class="hidden">
            <!-- Status Bar -->
            <div class="status-bar" id="statusBar">
                <span id="currentTime"></span>
                <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M0 11.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-2zm4-3a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-5zm4-3a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-8zm4-3a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-11z"/></svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M15.384 6.115a.485.485 0 0 0-.047-.736A12.444 12.444 0 0 0 8 3C5.259 3 2.723 3.882.663 5.379a.485.485 0 0 0-.048.736.518.518 0 0 0 .732.05c1.86-1.323 4.212-2.13 6.653-2.13s4.793.807 6.653 2.13a.518.518 0 0 0 .732-.05z"/><path d="M13.229 8.271a.482.482 0 0 0-.063-.745A9.455 9.455 0 0 0 8 6c-2.187 0-4.134.7-5.686 1.826a.482.482 0 0 0-.063.745.525.525 0 0 0 .737.065 8.46 8.46 0 0 1 5.01-1.663 8.46 8.46 0 0 1 5.01 1.663.525.525 0 0 0 .737-.065z"/><path d="M11.072 10.424a.483.483 0 0 0-.08-.753A6.462 6.462 0 0 0 8 8.5c-1.71 0-3.236.56-4.503 1.481a.483.483 0 0 0-.08.753.54.54 0 0 0 .742.078 5.46 5.46 0 0 1 3.84-1.343 5.46 5.46 0 0 1 3.84 1.343.54.54 0 0 0 .742-.078z"/><path d="M9.03 12.574a.483.483 0 0 0-.1-.76A3.462 3.462 0 0 0 8 11c-.863 0-1.65.29-2.28.714a.483.483 0 0 0-.1.76.54.54 0 0 0 .748.085A2.46 2.46 0 0 1 8 12a2.46 2.46 0 0 1 1.282.424.54.54 0 0 0 .748-.085z"/></svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M2 6h10v4H2V6z"/><path d="M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2zm12 1a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-1v-4h1z"/></svg>
                </div>
            </div>
            
             <!-- Floating Action Button for AI Chatbot -->
            <div class="absolute bottom-24 right-6 z-[1001]">
                <button class="w-16 h-16 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-transform transform hover:scale-110" data-target="aiChatbot">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
                </button>
            </div>
            
            <!-- Points Toast -->
            <div id="pointsToast" class="points-toast absolute bottom-24 left-1/2 -translate-x-1/2 bg-yellow-400 text-yellow-900 font-bold py-2 px-4 rounded-full shadow-lg opacity-0 -translate-y-4 z-[2000]">
                +10 Points!
            </div>

            <!-- Bottom Navigation -->
            <div class="bottom-nav">
                <!-- Navigation buttons will be dynamically generated here -->
            </div>
        </div>
    </div>
    
    <!-- Leaflet JS for Interactive Map -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- GLOBAL STATE & APP DATA ---
        let appState = {
            userName: "there",
            healthScore: 85,
            height: 85.2,
            weight: 12.5,
            appointments: [],
            communityPosts: [
                {
                    author: "Anonymous Parent",
                    time: "2 hours ago",
                    avatar: "A",
                    color: "pink",
                    content: "My child refuses to eat vegetables. Any tips on how to make them more appealing?",
                    replies: 2,
                    likes: 10
                }
            ],
            badges: [
                { name: 'First Meal', icon: '🍲', unlocked: true, color: 'yellow' },
                { name: 'First Consult', icon: '👨‍⚕️', unlocked: true, color: 'blue' },
                { name: 'Growth Log', icon: '📈', unlocked: false, color: 'gray' }
            ],
        };

        const appView = document.getElementById('appView');
        const chromeUI = document.getElementById('chrome');

        let screenHistory = ['signUp']; 
        let map; // Define map variable in the global scope
        
        // --- SCREEN TEMPLATES ---
        const screens = {
            signUp: () => `
                <div class="p-8 pt-24 text-center">
                    <h1 class="text-4xl font-bold text-gray-800">Welcome to NutriSense</h1>
                    <p class="text-gray-500 mt-2">Let's get you set up.</p>
                    <div class="mt-10 space-y-6">
                        <div>
                            <label for="nameInput" class="sr-only">Name</label>
                            <input type="text" id="nameInput" placeholder="Enter your first name" class="w-full text-center text-lg bg-gray-100 border-2 border-gray-200 rounded-lg p-4 focus:border-blue-500 focus:ring-0 transition">
                        </div>
                        <div>
                            <p id="fingerprint-status" class="text-gray-600 font-medium mb-3">Tap to scan your fingerprint</p>
                            <canvas id="fingerprint-canvas" class="bg-gray-200 transition-colors duration-300 mx-auto" width="120" height="120"></canvas>
                        </div>
                    </div>
                    <button id="signUpBtn" class="w-full bg-blue-500 text-white font-bold py-4 rounded-xl mt-12 opacity-50 cursor-not-allowed" disabled>
                        Complete Sign Up
                    </button>
                </div>`,
            home: () => `
                <div class="p-6 pt-20 overflow-y-auto scroll-hidden h-full">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-500">Hello there,</p>
                            <h1 id="userNameDisplay" class="text-3xl font-bold text-gray-800 capitalize">${appState.userName}</h1>
                        </div>
                        <div class="relative cursor-pointer" data-target="profile">
                            <div class="w-14 h-14 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden">
                                <span class="text-2xl font-bold text-gray-600">${appState.userName.charAt(0).toUpperCase()}</span>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 bg-red-100 border border-red-200 text-red-800 p-4 rounded-2xl flex items-center justify-between cursor-pointer" data-target="disasterMode">
                        <div>
                            <p class="font-bold">Disaster Mode</p>
                            <p class="text-sm">Emergency nutrition info is available.</p>
                        </div>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </div>
                    <div class="mt-6 text-center">
                        <p class="text-sm font-medium text-gray-600">Your Child's Health Score</p>
                        <div class="relative inline-block my-2">
                            <svg class="w-32 h-32" viewBox="0 0 36 36">
                                <path class="text-gray-200" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3.5"></path>
                                <path class="text-green-500" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3.5" stroke-dasharray="${appState.healthScore}, 100" stroke-dashoffset="-5" stroke-linecap="round"></path>
                            </svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center">
                                <span class="text-3xl font-bold text-gray-800">${appState.healthScore}</span>
                                <span class="text-xs text-gray-500">Good</span>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500">Last updated: Today</p>
                    </div>
                    <h3 class="mt-6 font-bold text-lg text-gray-800">Key Actions</h3>
                    <div class="grid grid-cols-2 gap-4 mt-2">
                        <div class="bg-blue-100 p-4 rounded-2xl text-blue-800 cursor-pointer flex flex-col items-center justify-center text-center" data-target="symptomChecker"><svg class="w-8 h-8 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><p class="font-semibold text-sm">AI Symptom Checker</p></div>
                        <div class="bg-green-100 p-4 rounded-2xl text-green-800 cursor-pointer flex flex-col items-center justify-center text-center" data-target="nutriScan"><svg class="w-8 h-8 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg><p class="font-semibold text-sm">NutriScan</p></div>
                        <div class="bg-indigo-100 p-4 rounded-2xl text-indigo-800 cursor-pointer flex flex-col items-center justify-center text-center" data-target="doctorList"><svg class="w-8 h-8 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2z"></path></svg><p class="font-semibold text-sm">Consult a Doctor</p></div>
                        <div class="bg-purple-100 p-4 rounded-2xl text-purple-800 cursor-pointer flex flex-col items-center justify-center text-center" data-target="orderTrackingLocker"><svg class="w-8 h-8 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7l8-4 8 4m0 6l-8 4-8-4"></path></svg><p class="font-semibold text-sm">Locker Pickup</p></div>
                    </div>
                    <h3 class="mt-6 font-bold text-lg text-gray-800">Upcoming Appointments</h3>
                    <div id="appointmentsList" class="mt-2 bg-white p-4 rounded-2xl shadow-md">
                        ${appState.appointments.length === 0 ? "No appointments scheduled." : ""}
                    </div>
                    <div class="flex justify-between items-center mt-6">
                        <h3 class="font-bold text-lg text-gray-800">Community Buzz</h3>
                        <button class="bg-blue-100 text-blue-700 font-semibold text-xs py-1 px-3 rounded-lg" data-target="newPost">New Post</button>
                    </div>
                    <div id="homePostsContainer" class="space-y-2 mt-2">
                        ${appState.communityPosts.slice(0, 2).map(post => `
                            <div class="bg-white p-4 rounded-xl shadow-md">
                                <div class="flex items-start gap-3">
                                    <div class="w-10 h-10 rounded-full bg-${post.color}-200 flex items-center justify-center font-bold text-${post.color}-700">${post.avatar}</div>
                                    <div>
                                        <p class="font-semibold text-sm capitalize">${post.author}</p>
                                        <p class="text-xs text-gray-400">${post.time}</p>
                                    </div>
                                </div>
                                <p class="mt-3 text-gray-700 text-sm">${post.content}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>`,
            growthTracker: () => `
                <div class="p-6 pt-20">
                    <h1 class="text-2xl font-bold text-gray-800">Growth Tracker</h1>
                    <p class="text-gray-500">Monitoring your child's progress against WHO standards.</p>
                    <div id="growthSavedAlert" class="hidden mt-4 bg-green-100 text-green-800 p-3 rounded-lg text-sm">New growth data saved successfully!</div>
                    <div class="mt-4 bg-white p-4 rounded-2xl shadow-md">
                        <div class="w-full h-48 bg-gray-200 rounded-lg flex items-center justify-center">
                            <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mt-4 text-center">
                            <div><p class="text-sm text-gray-500">Height</p><p class="font-bold text-xl" id="displayHeight">${appState.height} cm</p><p class="text-xs text-green-600 font-semibold">Normal</p></div>
                            <div><p class="text-sm text-gray-500">Weight</p><p class="font-bold text-xl" id="displayWeight">${appState.weight} kg</p><p class="text-xs text-green-600 font-semibold">Normal</p></div>
                        </div>
                    </div>
                    <button class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl mt-6" data-target="addGrowthEntry">Add New Entry</button>
                </div>`,
            addGrowthEntry: () => `
                <div class="p-6 pt-20">
                    <button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <h1 class="text-2xl font-bold text-center">Add New Growth Entry</h1>
                    <div class="mt-8 space-y-4">
                        <div>
                            <label class="font-medium text-gray-700">Height (cm)</label>
                            <input id="heightInput" type="number" placeholder="e.g., ${appState.height + 0.5}" class="w-full mt-1 bg-gray-100 border-gray-300 rounded-lg p-3">
                        </div>
                        <div>
                            <label class="font-medium text-gray-700">Weight (kg)</label>
                            <input id="weightInput" type="number" placeholder="e.g., ${appState.weight + 0.2}" class="w-full mt-1 bg-gray-100 border-gray-300 rounded-lg p-3">
                        </div>
                    </div>
                    <button id="saveGrowthBtn" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl mt-8">Save Entry</button>
                </div>`,
            newPost: () => `
                <div class="p-6 pt-20">
                    <button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <h1 class="text-2xl font-bold text-center">New Post</h1>
                    <div class="mt-6 space-y-4">
                        <div>
                            <label class="font-medium text-gray-700">Your question</label>
                            <textarea id="postContent" class="w-full h-32 bg-gray-100 border-none rounded-lg p-4" placeholder="Describe your question in detail..."></textarea>
                        </div>
                    </div>
                    <button id="submitPostBtn" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl mt-8">Submit Post</button>
                </div>`,
            myBadges: () => `
                <div class="p-6 pt-20">
                    <button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <h1 class="text-2xl font-bold text-center">My Badges</h1>
                    <div class="grid grid-cols-3 gap-4 mt-6 text-center">
                        ${appState.badges.map(badge => `
                            <div class="text-center ${!badge.unlocked ? 'opacity-50' : ''}">
                                <div class="w-24 h-24 bg-${badge.color}-200 rounded-full flex items-center justify-center text-5xl mx-auto shadow-inner">${badge.icon}</div>
                                <p class="text-sm mt-2 font-medium">${badge.name}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>`,
            aiChatbot: () => `<div class="flex flex-col h-full"><div class="p-4 pt-16 bg-white border-b shadow-sm"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><div class="text-center"><p class="font-bold text-gray-800">AI Health Assistant</p><p class="text-sm text-green-500">Online</p></div></div><div id="chatLog" class="flex-1 p-6 overflow-y-auto space-y-4 scroll-hidden"></div><div id="chatSuggestions" class="p-4 bg-gray-100 border-t"><div class="flex flex-wrap gap-2"></div></div><div class="p-4 bg-white border-t flex items-center"><input id="chatInput" type="text" placeholder="Type your message..." class="flex-1 bg-gray-100 border-none rounded-full py-3 px-5"><button id="sendChatBtn" class="ml-3 p-3 bg-blue-600 text-white rounded-full"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.428A1 1 0 0010 16h.001a1 1 0 00.725-.317l5-1.428a1 1 0 001.17-1.409l-7-14z"></path></svg></button></div></div>`,
            stuntingHeatMap: () => `<div class="relative h-full pt-12"><div id="map"></div><div class="absolute top-16 left-0 w-full p-4 z-10"><div class="bg-white/90 backdrop-blur-sm p-4 rounded-2xl shadow-lg"><h1 class="text-xl font-bold">Stunting Heat Map: Global</h1><p class="text-sm text-gray-600 mb-2">Real-time stunting prevalence.</p><div class="space-y-1 text-xs"><div class="flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full border border-white"></span>High Prevalence</div><div class="flex items-center gap-2"><span class="w-3 h-3 bg-yellow-400 rounded-full border border-white"></span>Medium Prevalence</div><div class="flex items-center gap-2"><span class="w-3 h-3 bg-green-500 rounded-full border border-white"></span>Low Prevalence</div></div><div class="mt-4 space-y-2"><label for="clinicToggle" class="flex items-center cursor-pointer"><div class="relative"><input type="checkbox" id="clinicToggle" class="sr-only"><div class="block bg-gray-300 w-10 h-6 rounded-full"></div><div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition"></div></div><div class="ml-3 text-gray-700 font-medium text-sm">Show Nearest Health Center</div></label><label for="lockerToggle" class="flex items-center cursor-pointer"><div class="relative"><input type="checkbox" id="lockerToggle" class="sr-only"><div class="block bg-gray-300 w-10 h-6 rounded-full"></div><div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition"></div></div><div class="ml-3 text-gray-700 font-medium text-sm">Find N.E.X.U.S Locker</div></label></div></div></div><div id="lockerCard" class="map-card absolute bottom-0 left-0 w-full bg-white p-6 rounded-t-3xl shadow-lg"><div class="flex items-center"><div class="p-3 bg-purple-100 rounded-lg mr-4"><svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7l8-4 8 4m0 6l-8 4-8-4"></path></svg></div><div><p class="font-bold">Central Park Locker #1</p><p class="text-sm text-gray-500">Closest to you • 5 min walk</p></div></div></div></div>`,
            nutriEdu: () => `<div class="p-6 pt-20"><h1 class="text-2xl font-bold text-gray-800">NutriEdu Library</h1><p class="text-gray-500">Micro-learning for a healthier family.</p><div class="mt-6 relative"><input type="text" placeholder="Search lessons..." class="w-full bg-gray-100 border-none rounded-lg py-3 pl-10 pr-10"><svg class="absolute left-3 top-3.5 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg><button class="absolute right-3 top-3.5 text-gray-500"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg></button></div><div class="space-y-4 mt-6"><div class="bg-white p-4 rounded-xl shadow-md flex items-center gap-4 cursor-pointer" data-target="lessonDetail"><div class="w-24 h-16 bg-blue-100 rounded-lg flex items-center justify-center"><svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div class="flex-1"><p class="font-bold">Meal Prep for Toddlers</p><p class="text-xs text-gray-500 mt-1">Article • 5 min read</p></div></div><div class="bg-white p-4 rounded-xl shadow-md flex items-center gap-4 cursor-pointer" data-target="lessonDetail"><div class="w-24 h-16 bg-green-100 rounded-lg flex items-center justify-center"><svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><div class="flex-1"><p class="font-bold">Understanding Gov't Subsidies</p><p class="text-xs text-gray-500 mt-1">Article • 3 min read</p></div></div></div></div>`,
            lessonDetail: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><div class="w-full h-48 bg-green-100 rounded-2xl flex items-center justify-center my-6"><svg class="w-20 h-20 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><h1 class="text-2xl font-bold">Understanding Gov't Subsidies</h1><p class="text-sm text-gray-500 mt-1">Article • 3 min read</p><p class="mt-4 text-gray-700 leading-relaxed">This article explains the various government assistance programs available to families for nutritional support. We cover eligibility, how to apply, and what benefits you can receive to help ensure your child gets the best possible start in life.</p><button id="completeLessonBtn" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl mt-6">Mark as Complete (+10 Points)</button></div>`,
            profile: () => `<div class="p-6 pt-20"><div class="text-center"><div class="w-32 h-32 rounded-full mx-auto bg-gray-200 flex items-center justify-center text-5xl font-bold text-gray-600">${appState.userName.charAt(0).toUpperCase()}</div><h1 class="text-2xl font-bold mt-4 capitalize">${appState.userName}</h1><p class="text-gray-500">Joined June 2024</p></div><div class="mt-8 space-y-2"><button class="bg-white p-4 w-full rounded-lg flex justify-between items-center shadow-sm text-left" data-target="myBadges"><span>My Badges</span><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button><button class="bg-white p-4 w-full rounded-lg flex justify-between items-center shadow-sm text-left" data-target="linkKia"><span>Link KIA / BPJS</span><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button><button class="bg-white p-4 w-full rounded-lg flex justify-between items-center shadow-sm text-left" data-target="settings"><span>Settings & Language</span><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button><button class="bg-white p-4 w-full rounded-lg flex justify-between items-center shadow-sm text-left"><span>NGO / Volunteer Portal</span><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg></button></div></div>`,
            donate: () => `<div class="p-6 pt-20"><h1 class="text-2xl font-bold text-center">Make a Difference</h1><p class="text-center text-gray-500 mt-2">Your contribution helps us deliver vital nutrition to children in need.</p><div class="space-y-4 mt-8"><div class="bg-white p-4 rounded-xl shadow-md"><h3 class="font-semibold text-lg">Support Sumatra</h3><p class="text-sm text-gray-600 mt-1">Goal: Rp 5,000,000</p><div class="w-full bg-gray-200 rounded-full h-2.5 mt-2"><div class="bg-blue-600 h-2.5 rounded-full" style="width: 60%"></div></div><button class="w-full bg-green-600 text-white font-semibold py-2 rounded-lg mt-3" data-target="donationAmount">Donate to Sumatra</button></div><div class="bg-white p-4 rounded-xl shadow-md"><h3 class="font-semibold text-lg">Support Papua</h3><p class="text-sm text-gray-600 mt-1">Goal: Rp 10,000,000</p><div class="w-full bg-gray-200 rounded-full h-2.5 mt-2"><div class="bg-blue-600 h-2.5 rounded-full" style="width: 40%"></div></div><button class="w-full bg-green-600 text-white font-semibold py-2 rounded-lg mt-3" data-target="donationAmount">Donate to Papua</button></div><div class="bg-white p-4 rounded-xl shadow-md"><h3 class="font-semibold text-lg">Support Kalimantan</h3><p class="text-sm text-gray-600 mt-1">Goal: Rp 5,000,000</p><div class="w-full bg-gray-200 rounded-full h-2.5 mt-2"><div class="bg-blue-600 h-2.5 rounded-full" style="width: 85%"></div></div><button class="w-full bg-green-600 text-white font-semibold py-2 rounded-lg mt-3" data-target="donationAmount">Donate to Kalimantan</button></div></div></div>`,
            donationAmount: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><h1 class="text-2xl font-bold text-center">Enter Donation Amount</h1><div class="mt-8"><div class="relative"><input type="number" placeholder="50000" class="w-full text-center text-4xl font-bold border-0 border-b-2 border-gray-300 focus:ring-0 focus:border-blue-500 py-2"><span class="absolute right-0 top-3 text-lg font-medium text-gray-500">IDR</span></div></div><button class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl mt-8" data-target="donationProgress">Submit Donation</button></div>`,
            donationProgress: () => `<div class="p-6 pt-20 text-center flex flex-col justify-center items-center h-full"><div class="w-24 h-24 bg-green-500 text-white rounded-full flex items-center justify-center"><svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div><h1 class="text-2xl font-bold mt-6">Thank You!</h1><p class="text-gray-600 mt-2">Your generosity is making a real change.</p><div class="w-full bg-gray-200 rounded-full h-8 my-8 shadow-inner"><div class="bg-blue-600 h-8 rounded-full text-white flex items-center justify-center text-sm font-bold" style="width: 75%;">75%</div></div><p class="font-semibold text-lg">Rp 15,000,000 / Rp 20,000,000 Raised</p><button class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl mt-auto" data-target="home">Back to Home</button></div>`,
            linkKia: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><h1 class="text-2xl font-bold">Link KIA / BPJS</h1><p class="text-gray-500 mt-2">Connect your government health accounts for seamless integration.</p></div>`,
            settings: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><h1 class="text-2xl font-bold">Settings</h1><div class="mt-6"><label for="language" class="font-medium text-gray-700">Language</label><select id="language" class="w-full mt-1 bg-gray-100 border-gray-300 rounded-lg p-3"><option>English</option><option>Bahasa Indonesia</option><option>Basa Jawa</option></select></div></div>`,
            disasterMode: () => `<div class="p-6 pt-20 bg-red-800 text-white h-full"><button class="absolute top-6 left-4 text-white back-btn p-2 rounded-full hover:bg-red-700"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><h1 class="text-2xl font-bold text-center">Disaster Mode</h1><div class="text-center mt-4"><svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div><div class="mt-6"><h3 class="font-semibold text-lg">Emergency Nutrition Guide</h3><p class="text-sm opacity-90 mt-2">During floods, prioritize clean water. If possible, boil water for 1 minute. Rely on non-perishable items like canned fish and fortified biscuits.</p></div><div class="mt-6"><h3 class="font-semibold text-lg">Emergency Hotlines</h3><p class="text-sm opacity-90 mt-2">National Disaster: 112<br>Local Health Unit: 021-123-456</p></div><button class="w-full bg-white text-red-800 font-bold py-4 rounded-xl mt-8">Request Drone Relief</button></div>`,
            symptomChecker: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><h1 class="text-2xl font-bold text-center">AI Symptom Checker</h1><p class="text-center text-gray-500 mt-2">Describe the symptoms. This is not a substitute for professional medical advice.</p><div class="mt-6"><textarea class="w-full h-32 bg-gray-100 border-none rounded-lg p-4" placeholder="e.g., my child has a fever, is tired, and has no appetite..."></textarea><div class="flex justify-end mt-2"><button class="text-gray-500"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg></button></div></div><button class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl mt-4" data-target="symptomResult">Analyze Symptoms</button></div>`,
            symptomResult: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><h1 class="text-2xl font-bold text-center">Preliminary Analysis</h1><div class="mt-6 space-y-4"><div class="bg-yellow-100 p-4 rounded-xl"><h3 class="font-bold text-yellow-800">Possible Causes:</h3><ul class="list-disc list-inside text-sm text-yellow-700 mt-2"><li>Common flu or infection</li><li>Dehydration</li><li>Nutrient deficiency</li></ul></div><div class="bg-red-100 p-4 rounded-xl border-l-4 border-red-500"><h3 class="font-bold text-red-800">Red Flag Warning:</h3><p class="text-sm text-red-700 mt-1">High fever combined with lethargy can be serious. Please consult a doctor immediately.</p></div></div><button class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl mt-8" data-target="doctorList">Consult a Doctor Now</button></div>`,
            nutriScan: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><div class="text-center mt-8"><h1 class="text-2xl font-bold">NutriScan Camera</h1><p class="text-gray-500 mt-2">Scan your ingredients to get personalized, healthy recipes and food safety alerts.</p><div class="w-full h-48 bg-gray-200 rounded-2xl flex items-center justify-center my-8"><svg class="w-20 h-20 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><button class="w-full bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-200" data-target="cameraView"><div class="flex items-center justify-center"><svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>Scan Ingredients</div></button></div></div>`,
            cameraView: () => `<div class="relative h-full bg-gray-900"><button class="absolute top-6 left-4 text-white back-btn p-2 rounded-full hover:bg-white/20"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><div class="absolute inset-0 flex items-center justify-center text-white/50 text-lg">Camera Preview</div><div class="absolute inset-x-0 bottom-10 flex justify-center"><button class="w-20 h-20 bg-white rounded-full border-4 border-gray-400" data-target="ingredientsResult"></button></div></div>`,
            ingredientsResult: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><h1 class="text-2xl font-bold text-center">Ingredients Detected</h1><div class="w-full h-48 bg-gray-200 rounded-2xl flex items-center justify-center my-6"><svg class="w-20 h-20 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"></path></svg></div><p class="text-center text-gray-600">Our AI has identified the following items. You can remove any that are incorrect.</p><div class="flex flex-wrap gap-3 justify-center mt-6"><span class="bg-yellow-100 text-yellow-800 text-sm font-medium px-3 py-1.5 rounded-full flex items-center">Chicken Breast <button class="ml-2 text-yellow-500">x</button></span><span class="bg-orange-100 text-orange-800 text-sm font-medium px-3 py-1.5 rounded-full flex items-center">Carrots <button class="ml-2 text-orange-500">x</button></span><span class="bg-gray-200 text-gray-800 text-sm font-medium px-3 py-1.5 rounded-full flex items-center">Rice <button class="ml-2 text-gray-500">x</button></span></div><button class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl mt-8 shadow-lg shadow-blue-200" data-target="recipeList">Find Recipes</button></div>`,
            recipeList: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><h1 class="text-2xl font-bold">Recommended Recipes</h1><p class="text-gray-500">Based on market prices & your child's needs.</p><div class="space-y-4 mt-6"><div class="bg-white p-4 rounded-xl shadow-md flex items-center gap-4 cursor-pointer" data-target="recipeDetails"><div class="w-20 h-20 bg-yellow-100 rounded-lg flex-shrink-0 flex items-center justify-center"><svg class="w-10 h-10 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4M17 3v4m2-2h-4M18 17v4m2-2h-4M12 5V3m0 18v-2M5 12H3m18 0h-2"></path></svg></div><div class="flex-1"><div class="flex items-center gap-2"><p class="font-bold">Chicken & Carrot Porridge</p><span class="text-xs font-semibold text-white bg-yellow-500 px-2 py-0.5 rounded-full">🏆 Mothers' Choice</span></div><p class="text-sm text-gray-500 mt-1">High in Protein & Vitamin A</p><div class="flex items-center gap-4 text-xs mt-1"><span class="text-blue-600 font-semibold">~180 kcal</span><span class="text-green-600 font-semibold">Affordable</span></div></div></div></div></div>`,
            recipeDetails: () => `<div class="relative"><div class="w-full h-72 bg-gray-200 flex items-center justify-center"><svg class="w-24 h-24 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h18v18H3zM21 15h-6m6 0v-2m-6 2v-2"></path></svg></div><button class="absolute top-6 left-4 text-gray-800 back-btn bg-white/70 backdrop-blur-sm p-2 rounded-full hover:bg-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><div class="p-6 bg-white rounded-t-2xl -mt-5 relative"><h1 class="text-3xl font-bold mt-2">Chicken & Carrot Porridge</h1><p class="text-gray-500 mt-2">A delicious and nutrient-packed meal perfect for supporting healthy growth.</p><div class="mt-6"><h3 class="font-bold text-lg">Ingredients</h3><ul class="list-disc list-inside mt-2 text-gray-700 space-y-1"><li>1/2 cup Rice</li><li>1 small Chicken Breast, minced</li><li>1 Carrot, grated</li><li>4 cups Water or Broth</li></ul></div><div class="mt-6"><h3 class="font-bold text-lg">Instructions</h3><ol class="list-decimal list-inside mt-2 text-gray-700 space-y-2"><li>Wash rice and add to a pot with water or broth.</li><li>Bring to a boil, then add minced chicken and grated carrot.</li><li>Reduce heat, cover, and simmer for 20-25 minutes until rice is soft and creamy.</li><li>Serve warm.</li></ol></div></div></div>`,
            doctorList: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><h1 class="text-2xl font-bold text-gray-800">Consult a Doctor</h1><p class="text-gray-500 mt-1">First, let's check the symptoms.</p><div class="mt-4 bg-blue-50 border border-blue-200 p-4 rounded-xl cursor-pointer" data-target="symptomChecker"><h3 class="font-bold text-blue-800">AI Symptom Checker</h3><p class="text-sm text-blue-700">Get a quick analysis before you consult.</p></div><div class="space-y-4 mt-6"><div class="bg-white p-4 rounded-2xl shadow-md flex items-center cursor-pointer" data-target="doctorProfile"><div class="w-16 h-16 bg-gray-200 rounded-full mr-4 flex items-center justify-center"><svg class="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div><div class="flex-1"><p class="font-bold text-gray-800">Dr. Jose Rizal</p><p class="text-sm text-gray-500">Pediatrician</p></div></div></div></div>`,
            doctorProfile: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><div class="text-center"><div class="w-32 h-32 rounded-full mx-auto bg-gray-200 flex items-center justify-center"><svg class="w-16 h-16 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div><h1 class="text-2xl font-bold mt-4">Dr. Jose Rizal</h1><p class="text-gray-500">Pediatrician</p><p class="text-green-500 font-semibold mt-1">Online</p></div><p class="text-sm text-center text-gray-600 mt-4 leading-relaxed">Specializes in child nutrition and developmental health.</p><button class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl mt-8 shadow-lg shadow-blue-200" data-target="consultationMode">Consult Now</button></div>`,
            consultationMode: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><h1 class="text-2xl font-bold text-center">Choose Consultation Type</h1><div class="space-y-6 mt-8"><div class="border border-gray-300 p-6 rounded-2xl cursor-pointer" data-target="videoCall"><div class="flex items-center"><svg class="w-10 h-10 text-blue-600 mr-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg><div><h3 class="font-bold text-lg text-gray-800">Video Call</h3><p class="text-gray-600 text-sm">Face-to-face consultation</p></div></div></div><div class="border border-gray-300 p-6 rounded-2xl cursor-pointer" data-target="consultationChat"><div class="flex items-center"><svg class="w-10 h-10 text-blue-600 mr-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg><div><h3 class="font-bold text-lg text-gray-800">Live Chat</h3><p class="text-gray-600 text-sm">Text-based consultation</p></div></div></div></div></div>`,
            videoCall: () => `<div class="relative h-full bg-gray-900"><button class="absolute top-6 left-4 text-white back-btn p-2 rounded-full hover:bg-white/20"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><div class="absolute inset-0 flex items-center justify-center text-white/50 text-lg">Patient's Camera</div><div class="w-28 h-40 bg-gray-800 absolute top-20 right-6 rounded-lg border-2 border-white flex items-center justify-center text-white/50">Dr's Camera</div><div class="absolute inset-x-0 bottom-10 flex justify-center items-center gap-6"><button class="w-16 h-16 bg-gray-700/50 backdrop-blur-sm text-white rounded-full flex items-center justify-center"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg></button><button class="w-20 h-20 bg-red-600 text-white rounded-full flex items-center justify-center" data-target="home"><svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8l2-2m0 0l2 2m-2-2v2.5M20 12c.333-4.667-2.333-7-5-7s-5.333 2.333-5 7c.333 4.667 2.333 7 5 7s5.333-2.333 5-7z"></path></svg></button><button class="w-16 h-16 bg-gray-700/50 backdrop-blur-sm text-white rounded-full flex items-center justify-center"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div></div>`,
            consultationChat: () => `<div class="flex flex-col h-full"><div class="p-4 pt-16 bg-white border-b shadow-sm"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><div class="text-center"><p class="font-bold text-gray-800">Dr. Jose Rizal</p><p class="text-sm text-green-500">Online</p></div></div><div id="chatLog" class="flex-1 p-6 overflow-y-auto space-y-4"><div class="flex justify-start mb-4"><div class="bg-gray-200 p-3 rounded-lg max-w-xs">Hello Maria, how can I help you today?</div></div><div class="flex justify-end mb-4"><div class="bg-blue-600 text-white p-3 rounded-lg max-w-xs">Hi Doc, my son has had a slight fever since this morning.</div></div></div><div class="p-4 bg-white border-t flex items-center"><input id="chatInput" type="text" placeholder="Type your message..." class="flex-1 bg-gray-100 border-none rounded-full py-3 px-5"><button id="sendChatBtn" class="ml-3 p-3 bg-blue-600 text-white rounded-full"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.428A1 1 0 0010 16h.001a1 1 0 00.725-.317l5-1.428a1 1 0 001.17-1.409l-7-14z"></path></svg></button></div></div>`,
            orderTrackingLocker: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><h1 class="text-2xl font-bold text-center">Ready for Pickup</h1><div class="flex border-b mt-6"><button class="tab-btn flex-1 text-center font-semibold p-4 border-b-2 border-blue-600 text-blue-600" data-tab="qrCodeTab">QR Code</button><button class="tab-btn flex-1 text-center font-semibold p-4 border-b-2 border-transparent text-gray-500" data-tab="pinCodeTab">PIN Code</button></div><div id="qrCodeTab" class="tab-content text-center py-8"><p class="text-gray-500 mt-2">Scan this code at the N.E.X.U.S Locker to retrieve your order.</p><div class="my-8"><svg class="w-56 h-56 mx-auto" viewBox="0 0 256 256"><path fill="#1f2937" d="M184,80H160V64a32,32,0,0,0-64,0V80H72a8,8,0,0,0-8,8v96a8,8,0,0,0,8,8h24v16a8,8,0,0,0,16,0V192h16v16a8,8,0,0,0,16,0V192h24a8,8,0,0,0,8-8V88A8,8,0,0,0,184,80ZM112,64a16,16,0,0,1,32,0V80H112Z"/></svg></div></div><div id="pinCodeTab" class="tab-content text-center py-8 hidden"><p class="text-gray-500 mt-2">Enter this code on the locker's keypad to retrieve your order.</p><p class="text-6xl font-bold tracking-widest my-16">11-23-58</p></div></div>`,
            outpostInfo: () => `<div class="p-6 pt-20"><button class="absolute top-6 left-4 text-gray-600 back-btn p-2 rounded-full hover:bg-gray-100"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><h1 class="text-2xl font-bold">Our Health Outposts</h1><p class="text-gray-500">See where your donations are at work.</p><div class="w-full h-56 bg-gray-200 mt-4 rounded-xl flex items-center justify-center"><svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></div><p class="mt-4 font-semibold">Distributing vital supplies in a remote Sumatran village.</p><p class="mt-2 text-gray-700">Your recent donation helped provide 50 children with high-nutrient food packages, essential vitamins, and growth monitoring kits for the next three months.</p></div>`
        };

        const navItems = [
            { id: 'home', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>', label: 'Home'},
            { id: 'growthTracker', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>', label: 'Growth'},
            { id: 'stuntingHeatMap', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>', label: 'Map'},
            { id: 'nutriEdu', icon: '<path d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>', label: 'Learn'},
            { id: 'donate', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>', label: 'Donate'}
        ];
        
        // --- CORE APP LOGIC ---

        function renderScreen(screenId) {
            const screenFunction = screens[screenId] || screens['home'];
            const screenDiv = document.createElement('div');
            screenDiv.id = screenId;
            screenDiv.classList.add('figma-screen', 'scroll-hidden');
            screenDiv.innerHTML = screenFunction();
            appView.appendChild(screenDiv);
            
            requestAnimationFrame(() => {
                screenDiv.classList.add('active');
                const setupFunction = `setup_${screenId}`;
                if (window[setupFunction]) {
                    window[setupFunction]();
                }
            });
        }

        function navigateTo(screenId, isBack = false) {
            const currentActiveScreen = appView.querySelector('.figma-screen.active');
            
            if (currentActiveScreen && currentActiveScreen.id === screenId) return;

            if (currentActiveScreen) {
                currentActiveScreen.classList.remove('active');
                if (!isBack) {
                    currentActiveScreen.classList.add('inactive-left');
                }
                setTimeout(() => {
                    if (currentActiveScreen.id !== 'home' || isBack) { 
                         currentActiveScreen.remove();
                    }
                }, 400);
            }
            
            renderScreen(screenId);

            if (!isBack) {
                 if (screenHistory[screenHistory.length - 1] !== screenId) {
                    screenHistory.push(screenId);
                }
            }

            updateNav(screenId);
        }

        function goBack() {
            if (screenHistory.length > 1) {
                const currentScreenId = screenHistory.pop();
                const previousScreenId = screenHistory[screenHistory.length - 1];

                const currentScreen = document.getElementById(currentScreenId);
                if (currentScreen) {
                    currentScreen.classList.remove('active');
                    setTimeout(() => currentScreen.remove(), 400);
                }
                
                const previousScreen = document.getElementById(previousScreenId);
                if (previousScreen) {
                    previousScreen.classList.remove('inactive-left');
                    previousScreen.classList.add('active');
                    updateNav(previousScreenId);
                } else {
                    navigateTo(previousScreenId, true);
                }
            }
        }
        
        function updateNav(screenId) {
            const navContainer = chromeUI.querySelector('.bottom-nav');
            if (!navContainer) return;
            const targetNavItem = navItems.find(item => item.id === screenId);
            navContainer.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if (targetNavItem) {
                const activeBtn = navContainer.querySelector(`[data-target="${screenId}"]`);
                if (activeBtn) activeBtn.classList.add('active');
            } else {
                 const homeBtn = navContainer.querySelector(`[data-target="home"]`);
                 if(homeBtn) homeBtn.classList.add('active');
            }
        }

        function buildChrome() {
            const navContainer = chromeUI.querySelector('.bottom-nav');
            navContainer.innerHTML = navItems.map(item => `
                <button class="nav-btn text-center text-gray-500 flex-1" data-target="${item.id}">
                    <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">${item.icon}</svg>
                    <p class="text-xs mt-1">${item.label}</p>
                </button>
            `).join('');
            
            updateTime();
            setInterval(updateTime, 1000);
        }

        function updateTime() {
            const timeEl = document.getElementById('currentTime');
            if(timeEl) {
                timeEl.textContent = new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit'});
            }
        }

        // --- EVENT LISTENERS ---
        appView.addEventListener('click', handleAppClicks);
        chromeUI.addEventListener('click', handleAppClicks);

        function handleAppClicks(e) {
            const targetButton = e.target.closest('[data-target]');
            const backButton = e.target.closest('.back-btn');
            const completeLessonButton = e.target.closest('#completeLessonBtn');
            
            if (targetButton) {
                e.stopPropagation();
                const targetId = targetButton.dataset.target;
                if (targetButton.classList.contains('nav-btn')) {
                    screenHistory = ['home'];
                    if (targetId !== 'home') {
                        screenHistory.push(targetId);
                    }
                }
                navigateTo(targetId);
            } else if (backButton) {
                e.stopPropagation();
                goBack();
            } else if (completeLessonButton) {
                e.stopPropagation();
                const toast = document.getElementById('pointsToast');
                if(toast) {
                    toast.classList.remove('opacity-0', '-translate-y-4');
                    toast.classList.add('opacity-100', 'translate-y-0');
                    setTimeout(() => {
                         toast.classList.add('opacity-0', '-translate-y-4');
                         toast.classList.remove('opacity-100', 'translate-y-0');
                    }, 2000);
                }
                goBack();
            }
        }


        // --- SCREEN-SPECIFIC SETUP FUNCTIONS ---
        window.setup_signUp = function() {
            const canvas = document.getElementById('fingerprint-canvas');
            const statusEl = document.getElementById('fingerprint-status');
            const nameInput = document.getElementById('nameInput');
            const signUpBtn = document.getElementById('signUpBtn');
            const ctx = canvas.getContext('2d');
            let isScanned = false;

            function drawInitial() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.strokeStyle = '#9ca3af';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(60, 60, 40, 0, Math.PI * 2);
                ctx.stroke();
                ctx.font = '12px Inter';
                ctx.fillStyle = '#6b7280';
                ctx.textAlign = 'center';
                ctx.fillText('Tap', 60, 65);
            }
            drawInitial();

            canvas.addEventListener('click', () => {
                if (isScanned) return;
                statusEl.textContent = "Scanning...";
                let radius = 0;
                const anim = setInterval(() => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.strokeStyle = '#3b82f6';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(60, 60, radius, 0, Math.PI * 2);
                    ctx.stroke();
                    radius += 2;
                    if (radius > 55) {
                        clearInterval(anim);
                        statusEl.textContent = "Scan Complete!";
                        statusEl.classList.add('text-green-600', 'font-bold');
                        canvas.classList.add('fingerprint-success');
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.strokeStyle = 'white';
                        ctx.lineWidth = 4;
                        ctx.beginPath();
                        ctx.moveTo(35, 60);
                        ctx.lineTo(55, 80);
                        ctx.lineTo(85, 45);
                        ctx.stroke();
                        isScanned = true;
                        validateForm();
                    }
                }, 20);
            });
            
            nameInput.addEventListener('input', validateForm);

            function validateForm() {
                if (isScanned && nameInput.value.trim().length > 1) {
                    signUpBtn.disabled = false;
                    signUpBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    signUpBtn.disabled = true;
                    signUpBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }
            
            signUpBtn.addEventListener('click', () => {
                appState.userName = nameInput.value.trim();
                chromeUI.classList.remove('hidden');
                buildChrome();
                navigateTo('home');
            });
        }
        
        window.setup_addGrowthEntry = function() {
            document.getElementById('saveGrowthBtn').addEventListener('click', () => {
                const height = document.getElementById('heightInput').value;
                const weight = document.getElementById('weightInput').value;
                if (height && weight) {
                    appState.height = parseFloat(height);
                    appState.weight = parseFloat(weight);
                    goBack();
                }
            });
        }
        
        window.setup_newPost = function() {
            document.getElementById('submitPostBtn').addEventListener('click', () => {
                const content = document.getElementById('postContent').value.trim();
                if (content) {
                    appState.communityPosts.unshift({
                        author: appState.userName,
                        time: "Just now",
                        avatar: appState.userName.charAt(0).toUpperCase(),
                        color: "blue",
                        content: content,
                        replies: 0,
                        likes: 0
                    });
                    
                    const homeScreen = document.getElementById('home');
                    if (homeScreen) {
                       const postsContainer = homeScreen.querySelector('#homePostsContainer');
                       if(postsContainer) {
                           postsContainer.innerHTML = appState.communityPosts.slice(0, 2).map(post => `
                            <div class="bg-white p-4 rounded-xl shadow-md mt-2">
                                <div class="flex items-start gap-3">
                                    <div class="w-10 h-10 rounded-full bg-${post.color}-200 flex items-center justify-center font-bold text-${post.color}-700">${post.avatar}</div>
                                    <div>
                                        <p class="font-semibold text-sm capitalize">${post.author}</p>
                                        <p class="text-xs text-gray-400">${post.time}</p>
                                    </div>
                                </div>
                                <p class="mt-3 text-gray-700 text-sm">${post.content}</p>
                            </div>
                        `).join('');
                       }
                    }
                    goBack();
                }
            });
        }
        
        window.setup_orderTrackingLocker = function() {
             const screen = document.getElementById('orderTrackingLocker');
             screen.addEventListener('click', e => {
                 if (e.target.classList.contains('tab-btn')) {
                     const parent = e.target.closest('.figma-screen');
                     parent.querySelectorAll('.tab-btn').forEach(btn => {
                         btn.classList.remove('active', 'text-blue-600', 'border-blue-600');
                         btn.classList.add('text-gray-500', 'border-transparent');
                     });
                     e.target.classList.add('active', 'text-blue-600', 'border-blue-600');
                     e.target.classList.remove('text-gray-500', 'border-transparent');
                     
                     parent.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                     parent.querySelector(`#${e.target.dataset.tab}`).classList.remove('hidden');
                 }
            });
        }

        window.setup_stuntingHeatMap = function() {
            if (document.getElementById('map') && typeof L !== 'undefined' && !map) {
                map = L.map('map').setView([-2.5, 118], 5);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '© OpenStreetMap' }).addTo(map);

                const heatZones = [ 
                     { lat: 14.5995, lng: 120.9842, color: 'red' }, { lat: 23.8103, lng: 90.4125, color: 'red' }, { lat: 9.0765, lng: 7.3986, color: 'red' }, { lat: -6.2088, lng: 106.8456, color: 'red' },{ lat: 28.3949, lng: 84.1240, color: 'yellow' }, { lat: -13.9626, lng: 33.7741, color: 'yellow' },{ lat: -1.2921, lng: 36.8219, color: 'yellow' }, { lat: 33.8869, lng: 9.5375, color: 'green' }, { lat: -35.6751, lng: -71.5430, color: 'green' },
                ];
                heatZones.forEach(zone => L.circle([zone.lat, zone.lng], { color: zone.color, fillColor: zone.color, fillOpacity: 0.5, radius: 200000 }).addTo(map));
                
                let clinicMarkers = L.layerGroup();
                let lockerMarkers = L.layerGroup();
                const initialMapView = { center: [-2.5, 118], zoom: 5 };
                const jakartaView = { center: [-6.176, 106.79], zoom: 14 };

                const puskesmasLocations = [ { lat: -6.17539, lng: 106.82715, name: "Health Center Gambir" }, { lat: -6.19, lng: 106.83, name: "Health Center Menteng" }];
                const puskesmasIcon = L.icon({ iconUrl: `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233b82f6'%3E%3Cpath d='M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z'/%3E%3C/svg%3E`, iconSize: [24, 24], iconAnchor: [12, 24], popupAnchor: [0, -24] });
                puskesmasLocations.forEach(p => L.marker([p.lat, p.lng], {icon: puskesmasIcon}).bindPopup(p.name).addTo(clinicMarkers));

                const lockerLocations = [{ lat: -6.178, lng: 106.8, name: "Central Park Locker #1" }, { lat: -6.17, lng: 106.82, name: "Medit Locker #2" }];
                const lockerIcon = L.icon({ iconUrl: `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%238b5cf6'%3E%3Cpath d='M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7l8-4 8 4m0 6l-8 4-8-4'/%3E%3C/svg%3E`, iconSize: [32, 32], iconAnchor: [16, 16] });
                lockerLocations.forEach(l => L.marker([l.lat, l.lng], {icon: lockerIcon}).bindPopup(l.name).addTo(lockerMarkers));

                document.getElementById('clinicToggle').addEventListener('change', function(e) {
                    if (e.target.checked) {
                        document.getElementById('lockerToggle').checked = false;
                        if (map.hasLayer(lockerMarkers)) map.removeLayer(lockerMarkers);
                        map.addLayer(clinicMarkers);
                        map.flyTo(jakartaView.center, 13, { animate: true, duration: 1.5 });
                    } else {
                        map.removeLayer(clinicMarkers);
                        map.flyTo(initialMapView.center, initialMapView.zoom);
                    }
                });

                document.getElementById('lockerToggle').addEventListener('change', function(e) {
                    if (e.target.checked) {
                        document.getElementById('clinicToggle').checked = false;
                        if(map.hasLayer(clinicMarkers)) map.removeLayer(clinicMarkers);
                        map.addLayer(lockerMarkers);
                        map.flyTo(jakartaView.center, 14, { animate: true, duration: 1.5 });
                    } else {
                        map.removeLayer(lockerMarkers);
                        map.flyTo(initialMapView.center, initialMapView.zoom);
                    }
                });
            }
        }
        
        // --- INITIALIZE APP ---
        navigateTo('signUp');

    });
    </script>
</body>
</html>
